<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaptureGrid: Hacker CTF Bingo</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #1a1a1a;
            color: #00ff00;
            display: flex;
            flex-direction: column;
            align-items: left;
            padding: 20px;
        }
        h1 {
            text-shadow: 0 0 10px #00ff00;
            text-align: center;
        }
        #game-container {
            display: flex;
            justify-content: center;
            width: 100%;
            max-width: 1200px;
        }
        #game-info {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            margin-right: 20px;
        }
        #grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            max-width: 800px;
        }
        .challenge {
            background-color: #2a2a2a;
            border: 1px solid #00ff00;
            padding: 10px;
            text-align: center;
            transition: all 0.3s ease;
            height: 180px; /* Increased height to accommodate buttons */
            width: 120px; /* Slightly increased width */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .challenge:hover {
            background-color: #3a3a3a;
            transform: scale(1.05);
        }
        .challenge.claimed-red { background-color: #8B0000; }
        .challenge.claimed-blue { background-color: #00008B; }
        .challenge.claimed-green { background-color: #006400; }
        .challenge.claimed .challenge-buttons {
            display: none;
        }
        .challenge-name {
            font-size: 12px;
            margin-bottom: 5px;
            height: 40px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .challenge-status {
            font-size: 10px;
            height: 20px;
        }
        .challenge-prize {
            font-size: 10px;
            color: #FFD700;
            height: 30px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .challenge-buttons {
            display: flex;
            flex-direction: column; /* Changed to column layout */
            justify-content: center;
            align-items: center;
            margin-top: 10px;
            height: 60px; /* Increased height for buttons */
        }
        .challenge-button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 10px; /* Slightly reduced font size */
            margin: 2px 0; /* Adjusted margin */
            cursor: pointer;
            border-radius: 3px;
            width: 90%; /* Set width relative to parent */
        }
        #graph {
            display: flex;
            align-items: flex-end;
            height: 300px;
            margin-top: 20px;
        }
        .bar {
            width: 50px;
            margin: 0 10px;
            transition: height 0.5s ease;
        }
        .bar-red { background-color: #FF0000; }
        .bar-blue { background-color: #0000FF; }
        .bar-green { background-color: #00FF00; }
        .bar-label {
            text-align: center;
            margin-top: 5px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #2a2a2a;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #00ff00;
            width: 80%;
            max-width: 600px;
            color: #00ff00;
        }
        .close {
            color: #00ff00;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>CaptureGrid: Hacker CTF Bingo</h1>
    <div id="game-container">
        <div id="game-info">
            <div>User: Guest (Green Team)</div>
            <div>Time Left: <span id="timer">05:00</span></div>
            <div>Red Team Points: <span id="red-points">0</span></div>
            <div>Blue Team Points: <span id="blue-points">0</span></div>
            <div>Green Team Points: <span id="green-points">0</span></div>
            <div id="graph">
                <div>
                    <div class="bar bar-red" id="red-bar"></div>
                    <div class="bar-label">Red</div>
                </div>
                <div>
                    <div class="bar bar-blue" id="blue-bar"></div>
                    <div class="bar-label">Blue</div>
                </div>
                <div>
                    <div class="bar bar-green" id="green-bar"></div>
                    <div class="bar-label">Green</div>
                </div>
            </div>
        </div>
        <div id="grid"></div>
    </div>

    <div id="challengeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalChallengeName"></h2>
            <p id="modalChallengeDetails"></p>
        </div>
    </div>

    <script>
        const challengeNames = [
            "SQLpuppy", "SSHhhh in the Library", "Reverse Gear", "Web Weaver",
            "Crypto Castle", "Buffer Overflow Bonanza", "XSS Marks the Spot", "Binary Bard",
            "Packet Pirate", "Malware Manor", "Rootkit Rodeo", "Steganosaurus Rex",
            "MITM Mayhem", "Phishing Frenzy", "Hash Brown", "JWT Joyride",
            "Docker Daredevil", "API Avalanche", "IDOR Odyssey", "Regex Wrangler",
            "Zero-Day Zoo", "Firewall Fiesta", "Sandbox Escape", "Heap Heap Hooray",
            "OSINT Oracle", "Reverse Shell Roulette", "DLL Dillema", "Kerberos Kerfuffle",
            "Cipher Salad", "Format String Fiasco", "Race Condition Rally", "Shellcode Shuffle",
            "Firmware Fandango", "Keylogger Karaoke", "Wireshark Waltz"
        ];

        const prizes = [
            "$100 PayPal", "Hak5 WiFi Pineapple", "Proxmark3 Kit", "1-Year VPN Subscription",
            "Custom Hoodie", "Raspberry Pi 4", "Bug Bounty Swag Pack", "Arduino Starter Kit",
            "$50 DigitalOcean Credit", "Rubber Ducky", "Lockpick Set", "CTF Champion Trophy"
        ];

        const teams = ['red', 'blue', 'green'];
        let points = {red: 0, blue: 0, green: 0};
        let timeLeft = 300; // 5 minutes in seconds
        let gameSimulationInterval;
        let timerInterval;

        function createGrid() {
            const grid = document.getElementById('grid');
            challengeNames.forEach((name, index) => {
                const challenge = document.createElement('div');
                challenge.className = 'challenge';
                const hasPrize = Math.random() < 0.3; // 30% chance of having a prize
                const prize = hasPrize ? prizes[Math.floor(Math.random() * prizes.length)] : null;
                challenge.innerHTML = `
                    <div class="challenge-name">${name}</div>
                    <div class="challenge-status">Unclaimed</div>
                    ${prize ? `<div class="challenge-prize">Prize: ${prize}</div>` : ''}
                    <div class="challenge-buttons">
                        <button class="challenge-button view-challenge">View Challenge</button>
                        <button class="challenge-button submit-challenge">Submit</button>
                    </div>
                `;
                challenge.querySelector('.view-challenge').onclick = () => viewChallenge(name);
                challenge.querySelector('.submit-challenge').onclick = () => submitChallenge(challenge, 'green');
                grid.appendChild(challenge);
            });
        }

        function viewChallenge(name) {
            const modal = document.getElementById('challengeModal');
            const modalChallengeName = document.getElementById('modalChallengeName');
            const modalChallengeDetails = document.getElementById('modalChallengeDetails');

            modalChallengeName.textContent = name;
            modalChallengeDetails.textContent = `This is a detailed description of the ${name} challenge. It includes information about the challenge, hints, and any relevant resources.`;

            modal.style.display = "block";
        }

        function submitChallenge(challenge, team) {
            if (!challenge.classList.contains('claimed')) {
                claimChallenge(challenge, team);
            }
        }

        function claimChallenge(challenge, team) {
            challenge.classList.add('claimed');
            challenge.classList.add(`claimed-${team}`);
            challenge.querySelector('.challenge-status').textContent = `Claimed by ${team}`;
            points[team]++;
            updatePoints();
            updateGraph();
            checkGameEnd();

            const prizeElement = challenge.querySelector('.challenge-prize');
            if (prizeElement) {
                //alert(`${team.toUpperCase()} team won: ${prizeElement.textContent}`);
            }
        }

        function updatePoints() {
            teams.forEach(team => {
                document.getElementById(`${team}-points`).textContent = points[team];
            });
        }

        function updateGraph() {
            const maxPoints = Math.max(...Object.values(points));
            teams.forEach(team => {
                const bar = document.getElementById(`${team}-bar`);
                const height = maxPoints > 0 ? (points[team] / maxPoints) * 280 : 0; // 280px is max height
                bar.style.height = `${height}px`;
            });
        }

        function simulateGame() {
            const unclaimedChallenges = Array.from(document.getElementsByClassName('challenge'))
                .filter(c => !c.classList.contains('claimed'));
            
            if (unclaimedChallenges.length > 0) {
                const randomChallenge = unclaimedChallenges[Math.floor(Math.random() * unclaimedChallenges.length)];
                const randomTeam = teams[Math.floor(Math.random() * (teams.length - 1))]; // Exclude green (player's team)
                claimChallenge(randomChallenge, randomTeam);
            }
        }

        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft > 0) {
                timeLeft--;
            } else {
                endGame("Time's up!");
            }
        }

        function checkGameEnd() {
            const allChallengesClaimed = Array.from(document.getElementsByClassName('challenge'))
                .every(c => c.classList.contains('claimed'));
            
            if (allChallengesClaimed) {
                endGame("All challenges have been claimed!");
            }
        }

        function endGame(reason) {
            clearInterval(gameSimulationInterval);
            clearInterval(timerInterval);
            const winner = Object.entries(points).reduce((a, b) => a[1] > b[1] ? a : b)[0];
            alert(`Game Over! ${winner.charAt(0).toUpperCase() + winner.slice(1)} team wins! ${reason}`);
        }

        function startGame() {
            createGrid();
            updateTimer();
            timerInterval = setInterval(updateTimer, 1000);
            gameSimulationInterval = setInterval(simulateGame, 3000); // Simulate a claim every 3 seconds
        }

        // Modal close functionality
        const modal = document.getElementById('challengeModal');
        const span = document.getElementsByClassName("close")[0];

        span.onclick = function() {
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        startGame();
    </script>
</body>
</html>
